---
title: "New analysis for megalinkers"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## New sensitivity analysis to validte results in the main text

For fossil co-occurence, only non-generalist species were used to reconstruct the ranges of extinct species. This was done to avoid over-estimating present-natural ranges by considering also co-occurrences with species with broad climatic tolerance and large geographic distribution (Faurby and Svenning 2015, Faurby et al. 2018). Importantly, present-natural ranges have been validated for North America previously (Faurby and Svenning 2015), showing thus a to be accurate estimates at global and continental scales. To further explore potential biases in the PHYLACINE database that could affect out resutls, we derived the home range distribution for the overall terrestrial mammal assemblage of each continents in each scenario. Specifically, we obtained the list of terrestrial mammal that occurred in the continents separately for each scenario and then we estimated the average and maximum home ranges for the overall assemblages of the continents.

```{r libraries, include=FALSE}
library(tidyverse)
```

```{r fake libraries, eval=FALSE}
library(tidyverse)
```

```{r load data}
res <- read_csv("Results/continent_list.csv") %>% 
  mutate(Scenario = factor(Scenario, levels = c("PN",
                                                "CU",
                                                "TH",
                                                "PNE")))
```

### Visualise the data
I boxplot body mass and home range of the assemblage list for each continent in the four scenarios: present-natural (PN), current (CU), threathened species extinct (TH), and present-natural extant species (PNE; this is the rewilding scenario with reintroduction of species in their present-natural ranges).

```{r visualize mass data}
res %>% 
  ggplot() +
  geom_boxplot(aes(Scenario, Mass.g, fill = Scenario)) +
  scale_y_log10() +
  facet_wrap(~Continent, ncol = 2, scales = "free") +
  ggtitle("Body mass of assemblages") +
  theme_classic() +
  theme(strip.background = element_blank())
```

```{r visualize homerange data}
res %>% 
  ggplot() +
  geom_boxplot(aes(Scenario, `Home range`, fill = Scenario)) +
  facet_wrap(~Continent, ncol = 2, scales = "free") +
  ggtitle("Home range of assemblages") +
  theme_classic() +
  theme(strip.background = element_blank())
```

From the boxplots, it seems there is not much change between scenarios as I expected. I then explore the number of species per scenario and per continent to understand what might cause this.

```{r data tally}
res %>% 
  group_by(Scenario) %>% 
  tally()

res %>% 
  group_by(Continent) %>% 
  tally()
```

I plot the distributions of home ranges for continents and scenarios. This might clarify some potential issues.

```{r homerange distribution, fig.height=10}
res %>% 
  ggplot() +
  geom_density(aes(`Home range`, col = Scenario)) +
  facet_wrap(~Continent, ncol = 1, scales = "free") +
  ggtitle("Home range distribution of assemblages") +
  theme_classic() +
  theme(strip.background = element_blank())
```

In this approach, changes are likely made insignificant by the large amount of species that did not change at all. Loosing few data points does not affect much the distributions of home ranges. The stratified random sampling is probably a good alternative for this, as it weights the distributions for the number of species observed. The random sampling can also give use some measures of uncertainty (e.g. variance) that we can use to perform statitical tests.